<link href="https://s3.amazonaws.com/mturk-public/bs30/css/bootstrap.css" media="screen" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
<style type="text/css">
#content {
    margin-bottom: 15px;
    padding: 10px 10px;
    font-family: Verdana, Geneva, sans-serif;
    color: #333333;
    font-size: 0.9em;
}

.header-toggle {
    color: white;
    font-weight: bold;
    cursor: pointer;
}
/* 
p {
    padding: 10px;
    margin: 0;
} */

p.yellow {
    font-size: 2em;
    border: 1px solid #ccc;
    border-radius: 3px;
    margin-bottom: 21px;
}

/* p.yellow span {
    background: orange;
    cursor: pointer;
} */

p.yellow::selection {
    color: black;
    background: lightblue;
}

p.yellow::-moz-selection { /* Code for Firefox */
    color: black;
    background: lightblue;
}

p.small {
  line-height: 0.2;
  size: 11px;
  margin-left:57px;
}


#question-hint {
    display: none;
}

.answers-select {
    display: none;
}

.x-button {
    color: red;
    background: white;
    border: 1px solid black;
    border-radius: 50%;
    margin: 0 10px;
    cursor: pointer;
    padding: 1px 6px;
}


.flex {
    display: flex;
    width: 100%;
}

.flex > input {
    width: 100%;
}

.comment{
    float: right;
    width: 30%;
}

.comment-general{
    border: 1px solid #ccc;
    border-radius: 3px;
    width: 100%
}


.discard{
    float: right;
    display: flex;
    color: lightblue;
}

.body{
    float:left;
    width:60%;
}

#skip, #another-question {
    float: right;
}

.another-question{
    float: right;
}

.panel-primary > .panel-heading {
color: #ffffff;
background-color: #ca427e;
border-color: #ea2279;
}

.panel-primary {
border-color: #df2d75;
}

.panel-info > .panel-heading {
color: #ffffff;
background-color: #7b96e4;
border-color: #bce8f1;
}

#all-answers {
    display: none;
    border-color: none;
}

:focus{
    outline: none;
}

.verbs{
    color: #ff6666;
}

/* .popup {
  position: relative;
  display: inline-block;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* The actual popup */
.popup .popuptext {
  visibility: hidden;
  width: 160px;
  background-color: #555;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 8px 0;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -80px;
}

/* Popup arrow */
.popup .popuptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}

/* Toggle this class - hide and show the popup */
.popup .show {
  visibility: visible;
  -webkit-animation: fadeIn 1s;
  animation: fadeIn 1s;
}

/* Add animation (fade in the popup) */
@-webkit-keyframes fadeIn {
  from {opacity: 0;} 
  to {opacity: 1;}
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity:1 ;}
} */

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<div id="example" style="display: none">
    <p class="yellow">$text$</p>
    <div class="panel-group">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    Ask a question where <mark>the highlighted word</mark> occurs in
                </h4>
            </div>
            <div class="panel-collapse collapse in">
                <div id='append-question' class="panel-body">
                    <br/>
                    <h4>Predefined Template Question</h4>

                    <div class="flex">
                        <select disabled>
                            <option value="">$predefined.question$</option>
                        </select>
                    </div>
                    <br/>
                    <h4>Answer</h4>
                <div class="hint">
                    Mark the parts of the question which are relevant answers
                </div>
                <ul>$answers1$</ul>
                </div>
            </div>
        </div>
    </div>
    <br/>
</div>


<section class="container" id="content">
    <div class="row col-xs-12 col-md-12">

<!-- Instructions -->
        <div class="panel panel-primary">
            <div class="panel-heading header-toggle" onmousedown="toggle('collapse1')">
                Instructions (click to collapse / expand)
            </div>

            <div class="panel-body">
                <div id="collapse1" style="display:none">
                    You will be given a sentence and a <mark>highlighted target noun</mark> denoting an entity mentioned in this sentence.
                    Your objective is to capture information that the sentence tells us about this entity. Specifically,
                    your task is to ask questions using the highlighted noun, and answer them using phrases from the sentence.
                    <br><strong>Example</strong>:
                    <br><u>Sentence</u>: The conservative <span style="background-color:#FF00FF">bent</span> of the incumbent appointees.
                    <br><u>Question</u>: What kind of <span style="background-color:#FF00FF">bent</span>?
                    <br>Answer: conservative
                    <br><u>Question</u>: <span style="background-color:#FF00FF">Bent</span> of what?
                    <br>Answer: the incumbent appointees
                    <br>
                    <br><strong><font size="4">Process</font></strong>
                    <br>
                    <ol>
                        <li>First read the sentence and notice where further information about the highlighted noun is
                             denoted in the sentence (commonly nearby the noun).</li>
                        <li>Choose your question from the given questions in the left drop-down menu.</li>
                        <li>Mark the answer to your question by highlighting a span in the sentence.</li>
                        <li>Click on the "+" button to produce another question-answer pair about the highlighted noun.</li>
                    </ol>
                    <br><strong><font size="4">1. Question</font></strong>
                    <br>The goal of the question is to clarify what kind of information does the phrase you are going to highlight
                     convey about the target noun. All the questions make use of the target noun. Choose the most appropriate question that makes sense for the given sentence.  
                    <br><u>Note:</u> When choosing a question, try to use questions that have a more specific and informative sense. These tend to appear higher on the drop-down menu.
                    <br>Comment: The questions are phrased in present tense, and to refer to singular nouns; however,
                     you can use them also for plural nouns and for past or future tenses.
                     <ul style="list-style-type:none">
                         <li>
                             <strong><font size='3'>1.1 PROPERTY Question</font></strong>
                         </li>
                         <li>
                            The first question in the drop-down menu is the PROPERTY question. When choosing this question, another line will appear under the menu, with a blank space in the place of the word [PROPERTY] in the question.
                            Fill in the blank with a single property word that makes sense for the given sentence and highlighted noun. Try to be broad and generic (yet accurate) when introducing properties.                            
                         </li>
                         <li>
                             <strong><font size='2'>Examples:</font></strong>
                             <ol>
                                 <li>
                                     <u>Sentence:</u> The <span style="background-color:#FF00FF">brothers</span> Montgolfier were the world 's first hot-air balloonists.
                                     <br><u>Question:</u> What is the [name] of (the) brothers?
                                     <br><u>Answer:</u> Montgolfier
                                 </li>
                                 <li>
                                    <u>Sentence:</u> Valley Ranch is the team's 30-acre practice <span style="background-color:#FF00FF">camp</span>.
                                    <br><u>Question:</u> What is the [size] of (the) camp?
                                    <br><u>Answer:</u> 30-acre
                                </li>
                                <li>
                                    <u>Sentence:</u> Stevric 's principals said they led the acquisition <span style="background-color:#FF00FF">group</span> that acquired the Nathan 's Famous Inc. restaurant chain..
                                    <br><u>Question:</u> What is the [purpose] of (the) group?
                                    <br><u>Answer:</u> acquired the Nathan 's Famous Inc. restaurant chain
                                </li>
                             </ol>
                         </li>
                     </ul>                     
                    <br><strong><font size="4">2. Answer Selection</font></strong>
                    <br>Select the answer span that answers your question by highlighting over the sentence. The answer span you selected from the sentence will be copied to the currently highlighted answer box. You cannot modify the answer, but you can instead remove it and select a new span.
                    <br><strong><font size="4">3. Further question-answer pairs (QAs)</font></strong>
                    <br>Commonly, there can be multiple valid question-answer pairs, corresponding to different bits of
                     information about the entity. Select the "+" in the bottom right of the screen to generate another
                      question. For each additional <strong>valid</strong> QA you generate beyond the first (up to 3), we will grant you a
                       2c bonus when reviewing the batch.
                    <br><strong><font size="4">4. Quality Assessment</font></strong>
                    <br>We will be tracking per-worker performance on this task, evaluated using the agreement you have with
                     other workers performing the same HITs. If your agreement rate becomes too low (whether for over-generating
                      or under-generating QAs), you will be disqualified from the task. Thus, you should be thorough think
                       carefully about the QA you generate. 
                </div>
            </div>
        </div>


        <!-- Examples -->

        <div class="panel panel-info">
            <div class="panel-heading header-toggle" onmousedown="toggle('collapse2')">
                Examples (click to collapse / expand)
            </div>

            <div class="panel-body" style="background: #ddd">
                <div id="collapse2" style="display:none;"><!--  -->
                    <!--- TODO Instructions -->

                    <div class="container" style="width: 100%;">
                        <!-- <h2>Examples</h2> -->

                        <ul class="nav nav-tabs" id="examples-header" style="display: inline-block;"></ul>

                        <div class="tab-content" id="examples-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <p class="yellow" id="text"></p>

    
        <form id="main-form" action="/action_page.php">
            <input id="all-answers" name="answers" type="hidden" value="" />
            <crowd-form>
            <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingOne">
                        <h4 class="panel-title">
                            Ask a question where the <mark><strong>highlighted word</strong></mark> occurs in.
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                         aria-labelledby="headingOne">
                         <div class="panel-body" id="q1">
                            <div class="comment">
                                <div class="discard">
                                <input type="button" name="discard-question" value="discard question" id="discard-question-1" onclick="discardQuestion(1)"/>
                                </div>
                                <br>
                                <br>
                                <br>
                                <label for="comment-1">Would you like to add a comment?</label>&nbsp;<br/>
                                <textarea class="form-control" cols="20" id="comment-1" maxlength="250" name="comment-1" rows="6"></textarea>
                            </div>
                            <div class="body">
                                <br>
                                <br>
                            <h4>Question</h4>
                            <div id="question-templates-1" class="flex">
                                <select name="question-1" id="question-1" onchange="onClickQuestion(1)">
                                    <option value="">(Pick a Question)</option>
                                    <option>Where is the [W]?</option>
                                    <option>When is the [W]?</option>
                                    <option>How much /How many [W]?</option>
                                    <option>What is the [W] a part/member of?</option>
                                    <option>What/Who is a part/member of [W]?</option>
                                    <option>What/Who is (the) [W]?</option>
                                    <option>What is the [PROPERTY] of (the) [W]?</option>
                                    <option>Whose [W]?</option>
                                    <option>What kind of [W]?</option>
                                </select>
                                <select name="question-spans" multiple id="question-spans" class="answers-select"></select>
 
                            </div>
                            <div id="question-1-property" hidden>
                                <br>
                                What is the 
                                <input  id="question-1-property-input" name="question-1-property-input" placeholder="Insert a property word" onClick="checkSubmitChange(1)">
                                of (the) [W]?
                                <!-- <p class="small" >(e.g: name, size, time etc.)</p> -->
                                <br>
                                <p id="property-examples-1"><u>Random examples:</u> [word_ideas]</p>
                            </div>
                            <div id="question-1-consist" hidden>
                                <br>
                                Pick the suitable words:
                                <input type="button" name="what-consist-1" value="What" id="what-consist-1" onclick="onClickWhat(`consist`, 1)"/>
                                /
                                <input type="button" name="who-consist-1" value="Who" id="who-consist-1" onclick="onClickWho(`consist`, 1)"/>
                                &nbsp;&nbsp;&nbsp;<input type="button" name="part-consist-1" value="part" id="part-consist-1" onclick="onClickPart(`consist`, 1)"/>
                                /
                                <input type="button" name="member-consist-1" value="member" id="member-consist-1" onclick="onClickMember(`consist`, 1)"/>
                                <br>
                                <br>
                                <input  id="question-1-consist-input-what-who"
                                 name="question-1-consist-input-what-who"
                                  placeholder=""
                                   readonly="readonly"
                                    onClick="checkSubmitChange(1)"
                                    size="5px">
                                is a
                                <input  id="question-1-consist-input-part-member"
                                 name="question-1-consist-input-part-member"
                                  placeholder=""
                                   readonly="readonly"
                                    onClick="checkSubmitChange(1)"
                                    size="7px">
                                    of [W]?
                            </div>
                            <div id="question-1-copular" hidden>
                                <br>
                                Pick the suitable words:
                                <input type="button" name="what-copular-1" value="What" id="what-copular-1" onclick="onClickWhat(`copular`, 1)"/>
                                /
                                <input type="button" name="who-copular-1"  value="Who" id="who-copular-1" onclick="onClickWho(`copular`, 1)"/>
                                &nbsp;&nbsp;&nbsp;<input type="button" name="the-copular-1" value="the [W]" id="the-copular-1" onclick="onClickThe(`copular`, 1)"/>
                                /
                                <input type="button" name="notthe-copular-1" value="[W]" id="notthe-copular-1" onclick="onClickNotThe(`copular`, 1)"/>
                                <br>
                                <br>
                                <input  id="question-1-copular-input-what-who"
                                 name="question-1-copular-input-what-who"
                                  placeholder=""
                                   readonly="readonly"
                                    onClick="checkSubmitChange(1)" size="5px">
                                    is
                                    <input  id="question-1-copular-input-the-notthe"
                                 name="question-1-copular-input-the-notthe"
                                  placeholder=""
                                   readonly="readonly"
                                    onClick="checkSubmitChange(1)" size="30px">?
                            </div>
                            <div id="question-1-partof" hidden>
                                <br>
                                Pick the suitable word:
                                <input type="button" name="part-partof-1" value="part" id="part-partof-1" onclick="onClickPart(`partof`, 1)"/>
                                /
                                <input type="button" name="member-partof-1" value="member" id="member-partof-1" onclick="onClickMember(`partof`, 1)"/>
                                <br>
                                <br>
                                What is the [W] a
                                <input  id="question-1-partof-input-part-member"
                                 name="question-1-partof-input-part-member"
                                  placeholder=""
                                   readonly="readonly"
                                    onClick="checkSubmitChange(1)" size="7px">
                                    of?
                            </div>
                                    <h4>Answer</h4>
                                    <div class="hint">
                                        Mark the part of the sentence which is a relevant answer
                                    </div>
                                        <div class="flex">
                                            <input name="answers-1" id="answers-select-1" placeholder="Mark the answer(s)"
                                                   readonly="readonly"
                                                   onClick="onClickAnswer(1)" size="20px"/>.
                                            <input hidden name="start-1" id="start-1"/>
                                            <input hidden name="end-1" id="end-1"/>
                                        </div>
                                        <br/>
                                        <input type="button" name="remove-button" value="remove answer" id="remove-button" onclick="removeAnswer(1)"/>
                                    <br/>
                                </div>
                                    
                                </div>
                        </div>
                    </div>
                </div>
                <br/>
                <!-- <label for="comment">Would you like to add a comment?</label>&nbsp;<br/> -->
                <textarea class="comment-general" cols="157.5" id="comment-general" maxlength="250" name="comment" rows="2" placeholder="Add general comments here..."></textarea>
                <br/>
                <br/>
                <input type="button" name="another-question" value="add QA" id="another-question" onclick="createQuestion()"/>
                <!-- <input type="button" value="Submit" onclick="submitFakeForm()" id="submit-button"/> -->
                <!-- <input type="submit" name="submit" value="Submit" id="submit"/> -->
                <!-- <crowd-button>
                    <iron-icon type="submit" id="submit" name="submit" value="Submit" icon="submit"/>
                </crowd-button> -->
                <crowd-button form-action="submit" variant="primary" data-testid="crowd-submit" name="submit" id="submit" disabled="isSubmitDisabled()">Submit</crowd-button>
            </div>
        </form>
    </crowd-form>
    </div>
</section>
<!-- close container -->

<script>
    let STEP = 1;
    let QUESTION_COUNTER = 1;
    let CURRENT_ANSWER = 1;
    let PREDICATE = ''
    const wordList = ['cause', 'performer', 'purpose', 'experiencer', 'employer', 'consumer', 'source',
                        'topic', 'manner', 'means', 'recipient', 'frequency', 'instrument', 'measure',
                        'result', 'goal', 'cause', 'purpose', 'direction', 'result', 'size', 'status']
const mainNode = document.getElementById("text");

function toggle(elementId) {
    const current = document.getElementById(elementId).style.display;
    document.getElementById(elementId).style.display = current === 'none' ? 'block' : 'none';
}

// function navigate(collapse, open, step) {
//     STEP = step;
//     console.log(document.getElementById(collapse));
//     $(document.getElementById(collapse)).collapse('hide');
//     $(document.getElementById(open)).collapse('show');

//     setMainText();
// }

const allForms = []

function ןsaveForm() {
    const form = document.querySelector("form");
    allForms.push($(form).serialize())

    const input = document.getElementById("all-answers");
    input.value = allForms.join("&&&&&&")
}

function anotherQuestion() {
    saveForm();
    const form = document.querySelector("form");
    form.reset();

    // navigate('collapseTwo', 'collapseOne', 1);

    // Reset question body
    // const body = document.getElementById("question-body");
    // body.setAttribute('disabled', 'disabled');

    // Reset question spans
    // console.log()
    document.getElementById("answers-select-1").innerHTML = "";
    document.getElementById("answers-1").innerHTML = "";


    updateValidation(QUESTION_COUNTER);
}
function replaceWordIdeas(question_num) {
  property_examples = document.getElementById("property-examples-" + question_num)
  property_examples.innerHTML = property_examples.innerHTML.replaceAll("[word_ideas]", randomPropertyWordIdeas().join(', '))
}

function randomPropertyWordIdeas(){
    const shuffled = wordList.sort(() => 0.5 - Math.random());
    let selected = shuffled.slice(0, 3);
    return selected
}

function submitFakeForm() {
    saveForm();

    const form = document.querySelector("main-form");
    form.submit();
}

function handleInputListener(){
    submitButton = document.getElementById("submit");
    submitButton.disabled = isSubmitDisabled();
}

function onClickQuestion(question_num){
    curr_question = document.getElementById(`question-` + question_num)
    var is_consist = false;
    if (curr_question.value.includes("[PROPERTY]")){
        handleProperty(question_num);
    }
    else{
        property_field = document.getElementById("question-" + question_num + "-property-input");
        property_field.value = '';
        property_field.removeEventListener('input-property', handleInputListener);
        property_question = document.getElementById("question-" + question_num + "-property");
        property_question.setAttribute("hidden", true);
    }

    if (curr_question.value.includes("What/Who is a part/member")){
        handleConsist(question_num);
        is_consist = true;
    }
    else{
        consist_field_what_who = document.getElementById("question-" + question_num + "-consist-input-what-who");
        consist_field_what_who.value = '';
        consist_field_part_member = document.getElementById("question-" + question_num + "-consist-input-part-member");
        consist_field_part_member.value = '';
        consist_field_what_who.removeEventListener('input-consist-what-who', handleInputListener);
        consist_field_part_member.removeEventListener('input-consist-part-member', handleInputListener);
        button_who = document.getElementById("who-consist-" + question_num)
        button_who.style = "inherit"
        button_what = document.getElementById("what-consist-" + question_num)
        button_what.style = "inherit"
        button_part = document.getElementById("part-consist-" + question_num)
        button_part.style = "inherit"
        button_member = document.getElementById("member-consist-" + question_num)
        button_member.style = "inherit"
        consist_question = document.getElementById("question-" + question_num + "-consist");
        consist_question.setAttribute("hidden", true);
    }
    if (curr_question.value.includes("What/Who is (the)")){
        handleCopular(question_num);
    }
    else{
        copular_field_what_who = document.getElementById("question-" + question_num + "-copular-input-what-who");
        copular_field_what_who.value = '';
        copular_field_what_who.removeEventListener('input-copular-what-who', handleInputListener);
        copular_field_the_notthe = document.getElementById("question-" + question_num + "-copular-input-the-notthe");
        copular_field_the_notthe.value = '';
        copular_field_the_notthe.removeEventListener('input-copular-the-notthe', handleInputListener);
        button_who = document.getElementById("who-copular-" + question_num)
        button_who.style = "inherit"
        button_what = document.getElementById("what-copular-" + question_num)
        button_what.style = "inherit"
        button_the = document.getElementById("the-copular-" + question_num)
        button_the.style = "inherit"
        button_notthe = document.getElementById("notthe-copular-" + question_num)
        button_notthe.style = "inherit"
        copular_question = document.getElementById("question-" + question_num + "-copular");
        copular_question.setAttribute("hidden", true);
    }
    if (curr_question.value.includes("a part/member") && !is_consist){
        handlePartof(question_num);
    }
    else{
        partof_field = document.getElementById("question-" + question_num + "-partof-input-part-member");
        partof_field.value = '';
        partof_field.removeEventListener('input-partof', handleInputListener);
        button_part = document.getElementById("part-partof-" + question_num)
        button_part.style = "inherit"
        button_member = document.getElementById("member-partof-" + question_num)
        button_member.style = "inherit"
        partof_question = document.getElementById("question-" + question_num + "-partof");
        partof_question.setAttribute("hidden", true);
    }
    onClickAnswer(question_num);
    submitButton = document.getElementById("submit");
    submitButton.disabled = isSubmitDisabled();
}

function handleProperty(question_num){
    property_question = document.getElementById("question-" + question_num + "-property");
    property_question.removeAttribute("hidden");
    const input = document.getElementById("question-"+ question_num +"-property-input")
    input.addEventListener('input-property', handleInputListener);
    replaceWordIdeas(question_num)
}

function handleConsist(question_num){
    consist_question = document.getElementById("question-" + question_num + "-consist");
    consist_question.removeAttribute("hidden");
    const input_what_who = document.getElementById("question-"+ question_num +"-consist-input-what-who")
    input_what_who.addEventListener('input-consist-what-who', handleInputListener);
    const input_part_member = document.getElementById("question-"+ question_num +"-consist-input-part-member")
    input_part_member.addEventListener('input-consist-part-member', handleInputListener);
}

function handleCopular(question_num){
    copular_question = document.getElementById("question-" + question_num + "-copular");
    copular_question.removeAttribute("hidden");
    const input_what_who = document.getElementById("question-"+ question_num +"-copular-input-what-who")
    input_what_who.addEventListener('input-copular-what-who', handleInputListener);
    const input_the_notthe = document.getElementById("question-"+ question_num +"-copular-input-the-notthe")
    input_the_notthe.addEventListener('input-copular-the-notthe', handleInputListener);
}

function handlePartof(question_num){
    partof_question = document.getElementById("question-" + question_num + "-partof");
    partof_question.removeAttribute("hidden");
    const input = document.getElementById("question-"+ question_num +"-partof-input-part-member")
    input.addEventListener('input-partof', handleInputListener);
}

function onClickWhat(template_name, question_num){
    curr_question = document.getElementById("question-" + question_num + "-" + template_name + "-input-what-who");
    curr_question.value = "What";
    button_what = document.getElementById("what-" + template_name + "-" + question_num)
    button_what.style.borderStyle = "inset";
    button_what.style.borderRadius = "3px";
    button_who = document.getElementById("who-" + template_name + "-" + question_num)
    button_who.style = "inherit"
    checkSubmitChange(question_num)

}

function onClickWho(template_name, question_num){
    curr_question = document.getElementById("question-" + question_num + "-" + template_name + "-input-what-who");
    curr_question.value = "Who";
    button_who = document.getElementById("who-" + template_name + "-" + question_num)
    button_who.style.borderStyle = "inset";
    button_who.style.borderRadius = "3px";
    button_what = document.getElementById("what-" + template_name + "-" + question_num)
    button_what.style = "inherit"
    checkSubmitChange(question_num)

}

function onClickPart(template_name, question_num){
    curr_question = document.getElementById("question-" + question_num + "-" + template_name + "-input-part-member");
    curr_question.value = "part";
    button_part = document.getElementById("part-" + template_name + "-" + question_num)
    button_part.style.borderStyle = "inset";
    button_part.style.borderRadius = "3px";
    button_member = document.getElementById("member-" + template_name + "-" + question_num)
    button_member.style = "inherit"
    checkSubmitChange(question_num)
}

function onClickMember(template_name, question_num){
    curr_question = document.getElementById("question-" + question_num + "-" + template_name + "-input-part-member");
    curr_question.value = "member";
    button_member = document.getElementById("member-" + template_name + "-" + question_num)
    button_member.style.borderStyle = "inset";
    button_member.style.borderRadius = "3px";
    button_part = document.getElementById("part-" + template_name + "-" + question_num)
    button_part.style = "inherit"
    checkSubmitChange(question_num)
}

function onClickThe(template_name, question_num){
    curr_question = document.getElementById("question-" + question_num + "-" + template_name + "-input-the-notthe");
    curr_question.value = "the " + PREDICATE;
    button_the = document.getElementById("the-" + template_name + "-" + question_num)
    button_the.style.borderStyle = "inset";
    button_the.style.borderRadius = "3px";
    button_notthe = document.getElementById("notthe-" + template_name + "-" + question_num)
    button_notthe.style = "inherit"
    checkSubmitChange(question_num)
}

function onClickNotThe(template_name, question_num){
    curr_question = document.getElementById("question-" + question_num + "-" + template_name + "-input-the-notthe");
    curr_question.value = PREDICATE;
    button_the = document.getElementById("notthe-" + template_name + "-" + question_num)
    button_the.style.borderStyle = "inset";
    button_the.style.borderRadius = "3px";
    button_notthe = document.getElementById("the-" + template_name + "-" + question_num)
    button_notthe.style = "inherit"
    checkSubmitChange(question_num)
}

function checkSubmitChange(question_num){
    submitButton = document.getElementById("submit");
    submitButton.disabled = isSubmitDisabled();
}

function onClickAnswer(question_num){
    const oldInput = document.getElementById(`answers-select-` + CURRENT_ANSWER);
    if (oldInput !== null){
        oldInput.style.border="1px solid grey";
        oldInput.style.boxShadow="initial";
        oldInput.style.borderRadius="2px";
    }
    CURRENT_ANSWER = question_num;
    const input = document.getElementById(`answers-select-` + CURRENT_ANSWER);
    input.style.border="3px solid lightblue";
    input.style.boxShadow="0 0 10px #9ecaed";
    input.style.borderRadius="2px";
    updateValidation(question_num);
}

function getQuestionBlock(){
    return document.createRange().createContextualFragment(`<div class="panel-body" id=q`+QUESTION_COUNTER+`>
                            <div class="comment">
                                <div class="discard">
                                <input type="button" name="discard-question" value="discard question" id="discard-question-`+QUESTION_COUNTER+`" onclick="discardQuestion(`+QUESTION_COUNTER+`)"/>
                                </div>
                                <br>
                                <br>
                                <br>
                                <label for="comment-`+QUESTION_COUNTER+`">Would you like to add a comment?</label>&nbsp;<br/>
                                <textarea class="form-control" cols="20" id="comment-`+QUESTION_COUNTER+`" maxlength="250" name="comment-`+QUESTION_COUNTER+`" rows="6"></textarea>
                            </div>
                            <div class="body">
                            <br>
                            <br>
                            <h4>Question</h4>

                            <div id="question-templates-` + QUESTION_COUNTER + `" class="flex">
                                <select name="question-`+QUESTION_COUNTER+`" id="question-`+QUESTION_COUNTER+`" onchange="onClickQuestion(`+QUESTION_COUNTER+`)">
                                    <option value="">(Pick a Question)</option>
                                    <option>Where is the [W]?</option>
                                    <option>When is the [W]?</option>
                                    <option>How much /How many [W]?</option>
                                    <option>What is the [W] a part/member of?</option>
                                    <option>What/Who is a part/member of [W]?</option>
                                    <option>What/Who is (the) [W]?</option>
                                    <option>What is the [PROPERTY] of (the) [W]?</option>
                                    <option>Whose [W]?</option>
                                    <option>What kind of [W]?</option>
                                </select>

                                <select name="question-spans" multiple id="question-spans" class="answers-select"></select>
                                </div>
                                <div id="question-`+QUESTION_COUNTER+`-property" hidden>
                                    <br>
                                    What is the 
                                    <input  id="question-`+QUESTION_COUNTER+`-property-input" name="question-`+QUESTION_COUNTER+`-property-input" placeholder="Insert a property word" onClick="checkSubmitChange(`+QUESTION_COUNTER+`)">
                                    of (the) [W]?
                                    <br>
                                    <p id="property-examples-`+QUESTION_COUNTER+`"><u>Random examples:</u> [word_ideas]</p>
                                </div>
                                <div id="question-`+QUESTION_COUNTER+`-consist" hidden>
                                    <br>
                                    Pick the suitable words:
                                    <input type="button" name="what-consist-`+QUESTION_COUNTER+`" value="What" id="what-consist-`+QUESTION_COUNTER+`" onclick="onClickWhat('consist', `+QUESTION_COUNTER+`)"/>
                                    /
                                    <input type="button" name="who-consist-`+QUESTION_COUNTER+`" value="Who" id="who-consist-`+QUESTION_COUNTER+`" onclick="onClickWho('consist', `+QUESTION_COUNTER+`)"/>
                                    &nbsp;&nbsp;&nbsp;<input type="button" name="part-consist-`+QUESTION_COUNTER+`" value="part" id="part-consist-`+QUESTION_COUNTER+`" onclick="onClickPart('consist', `+QUESTION_COUNTER+`)"/>
                                    /
                                    <input type="button" name="member-consist-`+QUESTION_COUNTER+`" value="member" id="member-consist-`+QUESTION_COUNTER+`" onclick="onClickMember('consist', `+QUESTION_COUNTER+`)"/>
                                    <br>
                                    <br>
                                    <input  id="question-`+QUESTION_COUNTER+`-consist-input-what-who"
                                    name="question-`+QUESTION_COUNTER+`-consist-input-what-who"
                                    placeholder=""
                                    readonly="readonly"
                                        onClick="checkSubmitChange(`+QUESTION_COUNTER+`)"
                                        size="5px">
                                    is a
                                    <input  id="question-`+QUESTION_COUNTER+`-consist-input-part-member"
                                    name="question-`+QUESTION_COUNTER+`-consist-input-part-member"
                                    placeholder=""
                                    readonly="readonly"
                                        onClick="checkSubmitChange(`+QUESTION_COUNTER+`)"
                                        size="7px">
                                        of [W]?
                                </div>
                                <div id="question-`+QUESTION_COUNTER+`-copular" hidden>
                                    <br>
                                    Pick the suitable word:
                                    <input type="button" name="what-copular-`+QUESTION_COUNTER+`" value="What" id="what-copular-`+QUESTION_COUNTER+`" onclick="onClickWhat('copular', `+QUESTION_COUNTER+`)"/>
                                    /
                                    <input type="button" name="who-copular-`+QUESTION_COUNTER+`"  value="Who" id="who-copular-`+QUESTION_COUNTER+`" onclick="onClickWho('copular', `+QUESTION_COUNTER+`)"/>
                                    &nbsp;&nbsp;&nbsp;<input type="button" name="the-copular-`+QUESTION_COUNTER+`" value="the [W]" id="the-copular-`+QUESTION_COUNTER+`" onclick="onClickThe('copular', `+QUESTION_COUNTER+`)"/>
                                /
                                <input type="button" name="notthe-copular-`+QUESTION_COUNTER+`" value="[W]" id="notthe-copular-`+QUESTION_COUNTER+`" onclick="onClickNotThe('copular', `+QUESTION_COUNTER+`)"/>
                                <br>
                                <br>
                                <input  id="question-`+QUESTION_COUNTER+`-copular-input-what-who"
                                 name="question-`+QUESTION_COUNTER+`-copular-input-what-who"
                                  placeholder=""
                                   readonly="readonly"
                                    onClick="checkSubmitChange(`+QUESTION_COUNTER+`)" size="5px">
                                    is
                                    <input  id="question-`+QUESTION_COUNTER+`-copular-input-the-notthe"
                                 name="question-`+QUESTION_COUNTER+`-copular-input-the-notthe"
                                  placeholder=""
                                   readonly="readonly"
                                    onClick="checkSubmitChange(`+QUESTION_COUNTER+`)" size="30px">?
                                </div>
                                <div id="question-`+QUESTION_COUNTER+`-partof" hidden>
                                    <br>
                                    Pick the suitable word:
                                    <input type="button" name="part-partof-`+QUESTION_COUNTER+`" value="part" id="part-partof-`+QUESTION_COUNTER+`" onclick="onClickPart('partof', `+QUESTION_COUNTER+`)"/>
                                    /
                                    <input type="button" name="member-partof-`+QUESTION_COUNTER+`" value="member" id="member-partof-`+QUESTION_COUNTER+`" onclick="onClickMember('partof', `+QUESTION_COUNTER+`)"/>
                                    <br>
                                    <br>
                                    What is the [W] a
                                    <input  id="question-`+QUESTION_COUNTER+`-partof-input-part-member"
                                    name="question-`+QUESTION_COUNTER+`-partof-input-part-member"
                                    placeholder=""
                                    readonly="readonly"
                                        onClick="checkSubmitChange(`+QUESTION_COUNTER+`)" size="7px">
                                        of?
                                </div>
                                        <h4>Answer</h4>
                                        <div class="hint">
                                            Mark the part of the sentence which is a relevant answer
                                        </div>
                                            <div class="flex">
                                                <input name="answers-`+QUESTION_COUNTER+`" id="answers-select-`+QUESTION_COUNTER+`" placeholder="Mark the answer(s)"
                                                    readonly="readonly"
                                                    onClick="onClickAnswer(`+QUESTION_COUNTER+`)" size="20px"/>.
                                                <input hidden name="start-`+QUESTION_COUNTER+`" id="start-`+QUESTION_COUNTER+`"/>
                                                <input hidden name="end-`+QUESTION_COUNTER+`" id="end-`+QUESTION_COUNTER+`"/>
                                            </div>
                                            <br/>
                                        <input type="button" name="remove-button" value="remove answer" id="remove-button" onclick="removeAnswer(`+QUESTION_COUNTER+`)"/>
                                    </div>
                                </div>
                        </div>`);
}

function createQuestion() {
    QUESTION_COUNTER = QUESTION_COUNTER + 1;
    var documentFragment = getQuestionBlock();
    var f = document.getElementById("collapseOne");
    f.appendChild(documentFragment);
    replaceWwithWord();
    submitButton = document.getElementById("submit");
    submitButton.disabled = isSubmitDisabled();
    add_button = document.getElementById("another-question");
    add_button.disabled = isAddAnotherQuestionDisabled();
}

function updateValidation(question_num) {
    setMainText(question_num);

    // const next1 = document.getElementById("next-1");
    // const submit = document.getElementById("submit-button");
    // const anotherQuestion = document.getElementById("another-question");
    // const form = document.querySelector("form");


    // if (form.question.value === "") {
    //     // next1.disabled = true;
    //     submit.disabled = anotherQuestion.disabled = true;
    //     return;
    // }

    // const q = document.getElementById("full-question");
    // q.innerText = form.question.value;


    // next1.disabled = false;

    // if (form['answers-1'].value !== "") {
    //     submit.disabled = anotherQuestion.disabled = false;
    // }
}

function removeAnswer(question_num){
    // console.log(document.getElementById("answers-select-1"));
    // console.log("hayush");
    document.getElementById("answers-select-"+ question_num).value = "";
    onClickAnswer(question_num);
    submitButton = document.getElementById("submit");
    submitButton.disabled = isSubmitDisabled();
}

function discardQuestion(question_num){
    var f = document.getElementById("collapseOne");
    var child = document.getElementById("q"+question_num);
    f.removeChild(child);
    submitButton = document.getElementById("submit");
    submitButton.disabled = isSubmitDisabled();
    add_button = document.getElementById("another-question");
    add_button.disabled = isAddAnotherQuestionDisabled();
}

function isSubmitDisabled(){
    var is_consist = false;
    for (let i = 1; i <= QUESTION_COUNTER; i++){
        curr_question = document.getElementById("question-" + i);
        curr_answer = document.getElementById("answers-select-" + i);
        if (curr_question !== null){
            if (curr_question.value === '' || curr_answer.value === ''){
                return true;
            }
            property_question = document.getElementById("question-" + i + "-property");
            if (curr_question.value.includes("[PROPERTY]")){
                property_field = document.getElementById("question-" + i +"-property-input");
                if (property_field.value === ''){
                    return true;
                }
            }
            consist_question = document.getElementById("question-" + i + "-consist");
            if (curr_question.value.includes("What/Who is a part/member")){
                is_consist = true;
                consist_field_what_who = document.getElementById("question-" + i +"-consist-input-what-who");
                if (consist_field_what_who.value === ''){
                    return true;
                }
                consist_field_part_member = document.getElementById("question-" + i +"-consist-input-part-member");
                if (consist_field_part_member.value === ''){
                    return true;
                }
            }

            copular_question = document.getElementById("question-" + i + "-copular");
            if (curr_question.value.includes("What/Who is (the)")){
                copular_field_what_who = document.getElementById("question-" + i +"-copular-input-what-who");
                if (copular_field_what_who.value === ''){
                    return true;
                }
                copular_field_the_notthe = document.getElementById("question-" + i +"-copular-input-the-notthe");
                if (copular_field_the_notthe.value === ''){
                    return true;
                }
            }

            partof_question = document.getElementById("question-" + i + "-partof");
            if (curr_question.value.includes("part/member") && !is_consist){
                partof_field = document.getElementById("question-" + i +"-partof-input-part-member");
                if (partof_field.value === ''){
                    return true;
                }
            }
        }
    }
    return false
}

function isAddAnotherQuestionDisabled(){
    var question_counter = 0;
    for (let i = 1; i <= QUESTION_COUNTER; i++){
        curr_question = document.getElementById("question-" + i);
        if (curr_question !== null){
            question_counter += 1;
        }
    }
    if (question_counter < 6){
        return false;
    }
    return true;
}

function isParent(parent, child) {
    let node = child;
    while (node) {
        if (node === parent) {
            return true;
        }
        node = node.parentElement;
    }
    return false;
}

function replaceOrRemovePrep(questionNode){
    if (prep === ''){
        var child_node = questionNode.querySelector("[name=question-" + QUESTION_COUNTER+"]");
        var options = child_node.children;
        for (i in options){
            if (options[i].text !== undefined){
                if (options[i].text.includes('[PREP]')){
                    child_node.removeChild(options[i]);
                }
            }
        }
    }
    else{
        questionNode.innerHTML = questionNode.innerHTML.replaceAll('[PREP]', prep);
    }
}

function replaceWwithWord(){
    const questionNode = document.getElementById("question-templates-" + QUESTION_COUNTER);
    let sentenceWords = sentence.split(' ');
    PREDICATE = sentenceWords[i1];
    questionNode.innerHTML = questionNode.innerHTML.replaceAll('[W]',sentenceWords[i1]);
    const questionPropertyNode = document.getElementById("question-" + QUESTION_COUNTER + "-property")
    questionPropertyNode.innerHTML = questionPropertyNode.innerHTML.replace('[W]',sentenceWords[i1]);
    const questionConsistNode = document.getElementById("question-" + QUESTION_COUNTER + "-consist")
    questionConsistNode.innerHTML = questionConsistNode.innerHTML.replace('[W]',sentenceWords[i1]);
    const questionCopularNode = document.getElementById("question-" + QUESTION_COUNTER + "-copular")
    questionCopularNode.innerHTML = questionCopularNode.innerHTML.replaceAll('[W]',sentenceWords[i1]);
    const questionPartofNode = document.getElementById("question-" + QUESTION_COUNTER + "-partof")
    questionPartofNode.innerHTML = questionPartofNode.innerHTML.replace('[W]',sentenceWords[i1]);
    // replaceOrRemovePrep(questionNode);
}

function setMainText(question_num) {
    let newSentence = sentence;

    if (STEP === 1) {
        const select = document.getElementById("question-spans");
        const options = Array.from(select.childNodes).map(n => [sentence.indexOf(n.innerText), n.innerText.length]);
        // console.log(options);
        for (let [i, len] of options) {
            let c_i = 0;
            let in_el = false;
            let newNewSentence = '';
            newSentence.split('').forEach(c => {
                if (in_el) {
                    if (c === ">") {
                        in_el = false;
                    }
                } else {
                    if (c === "<") {
                        in_el = true;
                    } else {
                        if (i === c_i) {
                            newNewSentence += "<span>";
                        } else if (i + len === c_i) {
                            newNewSentence += "</span>"
                        }
                        c_i++;
                    }
                }
                newNewSentence += c;
            });

            newSentence = newNewSentence;
            // console.log(newSentence)
        }
    }

    mainNode.innerHTML = processText(newSentence, i1, verb_indices);

    if (STEP === 1) {
        mainNode.querySelectorAll('span').forEach((span, i) => {
            span.addEventListener('click', () => {
                const select = document.getElementById("question-spans");
                Array.from(select.childNodes)[i].remove();
                setMainText(question_num);
            });
        });
    }
}
function listenToEvent(){
document.addEventListener('mouseup', () => {
    const selection = document.getSelection();
    console.log({
        selection,
        str: String(selection).trim()
    });
    selection_str = String(selection).trim()
    console.log("selection")
    // console.log(selection.anchorNode.parentNode)
    
    // addition for selecting full word
    if (!selection.isCollapsed) {

        // Detect if selection is backwards
        var range = document.createRange();
        range.setStart(selection.anchorNode, selection.anchorOffset);
        range.setEnd(selection.focusNode, selection.focusOffset);
        var backwards = range.collapsed;
        range.detach();

        // modify() works on the focus of the selection
        var endNode = selection.focusNode, endOffset = selection.focusOffset;
        selection.collapse(selection.anchorNode, selection.anchorOffset);

        var direction = [];
        if (backwards) {
            direction = ['backward', 'forward'];
        } else {
            direction = ['forward', 'backward'];
        }

        // selection.modify("move", direction[0], "character");
        // selection.modify("move", direction[1], "word");
        selection.extend(endNode, endOffset);
        selection.modify("extend", direction[1], "character");
        selection.modify("extend", direction[0], "word");
    }

    if (selection.rangeCount) {

        var startNode = selection.anchorNode
        var endNode = selection.focusNode

        if (backwards){
            startNode = selection.focusNode
            endNode = selection.anchorNode
        }

        start_value = Number(startNode.parentNode.id) + 1
        end_value = Number(endNode.parentNode.id) + 1

        if (backwards && endNode.parentNode.innerHTML === " "){
            end_value = end_value - 1
        }

        console.log(start_value)
        console.log(end_value)

        // Get the selected range
        // var range = selection.getRangeAt(0);    

        // // Check that the selection is wholly contained within the div text
        // // Create a range that spans the content from the start of the div
        // // to the start of the selection
        // var precedingRange = document.createRange();
        // var start;
        // if (backwards){
        //     start = selection.focusNode
        // }
        // else{
        //     start = selection.anchorNode
        // }
        // precedingRange.setStartBefore(start);
        // precedingRange.setEnd(range.startContainer, range.startOffset);

        // // Get the text preceding the selection and do a crude estimate
        // // of the number of words by splitting on white space
        // var textPrecedingSelection = precedingRange.toString();
        // var split_text = textPrecedingSelection.split(/\s+/);
        // // this is to fix the space before a word issue
        // if (split_text[split_text.length - 1] != ''){
        //     split_text.push('');
        // }
        // var wordIndex = split_text.length;
        // var child1 = mainNode.childNodes[0];
        // var child2 = mainNode.childNodes[1];
        // var child3 = mainNode.childNodes[2];
        // console.log("child1")
        // console.log(child1)
        // console.log("child2")
        // console.log(child2)
        // console.log("child3")
        // console.log(child3)
        // console.log("start")
        // console.log(start)
        // console.log(mainNode.childNodes)
        // console.log(child2.textContent)

        // if (start == child1){
        //     wordIndex = wordIndex;
        // }
        // else if (start == child3){
        //     wordIndex = wordIndex + child1.textContent.trim().split(/\s+/).length - 1 + child2.textContent.trim().split(/\s+/).length - 1;
        //     console.log(`index: ${wordIndex}`)
        // }
        // else{
        //     wordIndex = wordIndex + child1.textContent.trim().split(/\s+/).length - 1;
        // }
        // start_value = wordIndex;
        // end_value = wordIndex + selection_str.split(/\s+/).length - 1;
        // console.log("Word index start: " + wordIndex);
        // console.log("Word index end: " + (wordIndex + String(selection).split(/\s+/).length - 1))
    
    }

    // var start = selection.anchorOffset;
    // var end = selection.focusOffset;
    // console.log(mainNode.childNodes)
    // console.log('start at postion', start, 'in node', selection.anchorNode.wholeText)
    // console.log('stop at position', end, 'in node', selection.focusNode.wholeText)

    // console.log(selection)
    if (!selection.focusNode) {
        console.log("Make sure a focus node exists");
        return;
    }

    if (!isParent(mainNode, selection.anchorNode)) {
        console.log('anchorNode must be a child of mainNode');
        return;
    }

    if (!isParent(mainNode, selection.focusNode)) {
        console.log('focusNode must be a child of mainNode');
        return;
    }

    if (!isParent(mainNode, selection.extentNode)) {
        console.log('focusNode must be a child of mainNode');
        return;
    }


    const t = String(selection).trim();
    selection.empty();

    if (t.length === 0) {
        return;
    }

    let select, option;

    // select = document.getElementById("question-spans");
    // option = document.createElement("option");
    // option.selected = true;
    // option.innerText = t;
    // select.appendChild(option);

    // const body = document.getElementById("question-body");
    // body.value = (body.value + " " + t).trim();
    // body.removeAttribute('disabled');
    // const hint = document.getElementById("question-hint");
    // hint.style.display = 'block';


    

    const answer_body = document.getElementById("answers-select-" + CURRENT_ANSWER);
    answer_body.value = (answer_body.value + " " + t).trim();
    const start_body = document.getElementById("start-" + CURRENT_ANSWER);
    start_body.value = start_value;
    const end_body = document.getElementById("end-" + CURRENT_ANSWER);
    end_body.value = end_value;
    submitButton = document.getElementById("submit");
    submit.disabled = isSubmitDisabled();
    // answer_body.removeAttribute('disabled');

//            select = document.getElementById("answers-select-" + STEP);
//            option = document.createElement("option");
//            option.selected = true;
//            option.innerText = t;
//            select.appendChild(option);

    // console.log("answers-" + CURRENT_ANSWER);
    // const answers = document.getElementById("answers-" + CURRENT_ANSWER);
    // const li = document.createElement("li");
    const span = document.createElement("span");
    span.innerText = t;
    // li.appendChild(span);
    const button = document.createElement("span");
    button.innerText = "x";
    button.className = "x-button";
    // li.appendChild(button);
    button.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();

        // answers.removeChild(li);
        select.removeChild(option);
        updateValidation(CURRENT_ANSWER);
    });

    updateValidation(CURRENT_ANSWER);
    // selection.em pty();

});
}

$(document).ready(() => {
    updateValidation(CURRENT_ANSWER);

    setMainText(CURRENT_ANSWER);
});


function processText(text, i1, verb_indices) {
    const processedSentenceParts = text.split(' ');
    // const otherTargets = i2.split('_');
    // for (let i of otherTargets) {
    //     processedSentenceParts[Number(i)] = '<strong><font size="6">' + processedSentenceParts[Number(i)] + '</font></strong>'
    // }
    for (let i of [i1]) {
        processedSentenceParts[i] = '<strong><font id=' + i +' size="6">' + processedSentenceParts[i] + '</font></strong>'
        processedSentenceParts[i] = '<mark>' + processedSentenceParts[i] + '</mark>'
    }
    for (let j of verb_indices){
        let idx = Number(j)
        processedSentenceParts[idx] = '<font id=' + idx + ' class=verbs>' + processedSentenceParts[idx] + '</font>'
    }

    for (let k=0; k<processedSentenceParts.length; k++){
        if (k!= i1 && !verb_indices.includes(k)){
            processedSentenceParts[k] = '<text id=' + k + '>' + processedSentenceParts[k] + '</text>'
        }
    }

    var final_text =processedSentenceParts[0];
    for (let l=1; l<processedSentenceParts.length; l++){
        final_text += '<text id=' + l + '> </text>' + processedSentenceParts[l]
    }
    return final_text
}


if (!localStorage.getItem("seen-instructions")) {
    localStorage.setItem("seen-instructions", "True");
    toggle('collapse1');
    toggle('collapse2');
}


const examples = [
    {
        text: "Tens of billions of dollars",
        i1: 0,
        i2: '3',
        freeForm: "Tens of what?",
        predefined: {
            question: "Tens of what?",
        },
        answer1: ['billions of dollars'],
        answer2: ['billions of dollars']
    },
    {
        text: "My head’s width of five inches.",
        i1: 2,
        i2: '18',
        freeForm: "How has a disease been explained?",
        predefined: {
            question: "Whose width?",
            question2: "How much/ How many width?"
        },
        answer1: ['My head’s'],
        answer2: ['five inches']
    },
        {
        text: "`` What about those institutions that are supposed to be the bedrock of society , the banks and the bar association ... ? '' wrote a columnist for the Tribune-Democrat , a newspaper in nearby Johnstown , shortly after the scandal became public .",
        i1: 20,
        i2: '9',
        freeForm: "Who/what does the association consist of?",
        predefined: {
            question: "Who/what does the association consist of?"
        },
        answer1: ['bar'],
        answer2: ['bar']
    },
        {
        text: "`` He doesn't usually risk that much unless he thinks he has an ace in the hole , '' adds another Steinhardt Partners alumnus . ",
        i1: 23,
        i2: '7',
        freeForm: "what is someone an alumnus of?",
        predefined: {
            question: "what is someone alumnus of?",
            question2: "what kind of alumnus?"
        },
        answer1: ['Steinhardt Partners'],
        answer2: ['another']
    },
        {
        text: "A nonexecutive director of this British conglomerate.",
        i1: 2,
        i2: '8',
        freeForm: "Which organization does the director belong to?",
        predefined: {
            question: "Which organization does the director belong to?",
            question2: "What kind of director?"
        },
        answer1: ['this British conglomerate'],
        answer2: ['nonexecutive']
    },
            {
        text: "Annual capacity of 600,000 tons. ",
        i1: 1,
        i2: '21',
        predefined: {
            question: "How much is the capacity?",
            question2: "What kind of capacity?"
        },
        answer1: ['600,000 tons'],
        answer2: ['Annual']
    }
];

function getQuestion2Template(){
    return document.createRange().createContextualFragment(`<div id="question2">
        </br>
<h4>Predefined Template Question</h4>

<div class="flex">
    <select disabled>
        <option value="">$predefined.question2$</option>
    </select>
</div>
<br/>
<h4>Answer</h4>
<div class="hint">
Mark the parts of the question which are relevant answers
</div>
<ul>$answers2$</ul>
</div>`)
}
const examplesHeader = document.getElementById("examples-header");
const examplesContent = document.getElementById("examples-content");

examples.forEach((example, i) => {
    let question2template = getQuestion2Template();
    let appendQuestion = document.getElementById("append-question");

    if (example.predefined.question2){
        appendQuestion.appendChild(question2template);
    }
    let exampleContent = document.getElementById("example").innerHTML;

    if (example.predefined.question2){
        question2 = document.getElementById("question2");
        appendQuestion.removeChild(question2);
    }

    exampleContent = exampleContent.replace("$text$", processText(example.text, example.i1, example.i2));
    exampleContent = exampleContent.replace("$freeForm$", example.freeForm);
    exampleContent = exampleContent.replace("$predefined.question$", example.predefined.question);
    exampleContent = exampleContent.replace("$predefined.question2$", example.predefined.question2);

    const fullQuestion1 = example.predefined.contrastive + " " + example.predefined.be + " " + example.predefined.q;
    exampleContent = exampleContent.replace("$fullQuestion1$", fullQuestion1);
    exampleContent = exampleContent.replace("$answers1$", example.answer1.map(a => "<li><span>" + a + "</span><span class=\"x-button\">x</span></li>"));
    exampleContent = exampleContent.replace("$fullQuestion2$", example.freeForm);
    exampleContent = exampleContent.replace("$answers2$", example.answer2.map(a => "<li><span>" + a + "</span><span class=\"x-button\">x</span></li>"));
    const div = document.createElement('div');
    div.className = "tab-pane fade" + (i === 0 ? ' in active' : '');
    div.id = "example" + i;
    div.innerHTML = exampleContent;

    examplesContent.appendChild(div);

    examplesHeader.innerHTML += "<li><a data-toggle=\"tab\" href=\"#example" + i + "\">Example " + i + "</a></li>";
});

examplesHeader.querySelector("li").className = "active";
</script>


<script>
    // const sentence = 'My head\'s width of five inches.';
    // const sentence = "`` We will not go over a certain level , '' said David N. McCammon , Ford \'s vice president for finance , at a news conference yesterday in Dearborn , Mich . ";
    // const sentence = 'Air density decreases .'
    // const sentence = 'Air pressure is defined as the weight of the air pressing against a given area .';
    // const i1 = 19;
    // const i1 = 1;
    // const i1 = 14;
    // const verb_indices = [3,13]
    // const verb_indices = []
    // const verb_indices = '4&11  '.split('&');
    // const prep = 'for';
    const i2 = '8';

    const sentence = "${sentence}";
    const i1 = Number('${index}');
    const verb_indices = "${verbIndices}".split('&');
    // const verb_indices = ['']
    // const prep = "${prep}";
    const prep = '';

</script>
<script>
    replaceWwithWord();
    setMainText(1);
    listenToEvent();
    const input = document.getElementById(`answers-select-` + CURRENT_ANSWER);
    input.focus();

</script>